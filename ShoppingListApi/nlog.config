<?xml version="1.0" encoding="utf-8" ?>
<nlog xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <targets>
        <!-- File Target with structured JSON output -->
        <target xsi:type="File" name="fileTarget"
                fileName="logs/${date:format=yyyy}/${date:format=MM}/logfile-${date:format=yyyy-MM-dd}.json"
                archiveFileName="logs/${date:format=yyyy}/${date:format=MM}/archive/logfile-{#}.json"
                archiveNumbering="Rolling"
                maxArchiveFiles="30"
                layout='{
              "timestamp": "${longdate}",
              "errorNumber": "${event-properties:ErrorNumber}",
              "exceptionClass": "${event-properties:ExceptionClass}",
              "exceptionMethod": "${event-properties:ExceptionMethod}",
              "message": "${message}",
              "stackTrace": "${exception:format=StackTrace}"
            }' />

        <!-- Console Target -->
        <target xsi:type="Console" name="consoleTarget"
                layout='{
              "timestamp": "${longdate}",
              "errorNumber": "${event-properties:ErrorNumber}",
              "exceptionClass": "${event-properties:ExceptionClass}",
              "exceptionMethod": "${event-properties:ExceptionMethod}",
              "message": "${message}",
              "stackTrace": "${exception:format=StackTrace}"
            }' />
    </targets>

    <rules>
        <logger name="*" minlevel="Error" writeTo="fileTarget" />
        <logger name="*" minlevel="Debug" writeTo="consoleTarget" />
    </rules>
</nlog>
